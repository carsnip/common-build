apply plugin: 'application'

mainClassName = projectMainClass //required by application plugin
version = projectVersion

apply from: 'https://raw.githubusercontent.com/carsnip/common-build/master/common.gradle'

String jolokiaPort = "7777"
String dockerRepo = "963107833485.dkr.ecr.eu-west-1.amazonaws.com"
String dockerTag = project.hasProperty('tag') ? project.property('tag') : "test"

jib {
  from {
    image = "$dockerRepo/docker-java-11.0.5-jre:master-11"
  }
  to {
    image = "$dockerRepo/$projectName:$dockerTag"
  }
  container {
    jvmFlags = ['-XX:+ExitOnOutOfMemoryError', "-javaagent:/opt/jolokia.jar=port=${jolokiaPort},host=*".toString()]
    mainClass = projectMainClass
  }
}

if (project.hasProperty('xmx')) {
	jib.container.jvmFlags.add(0, '-Xmx' + project.property('xmx'))
}
