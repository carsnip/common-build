apply plugin: 'application'

mainClassName = projectMainClass
version = projectVersion

apply from: 'https://raw.githubusercontent.com/carsnip/common-build/master/common.gradle'

String jolokiaPort = "7777"
String dockerRepo = "963107833485.dkr.ecr.eu-west-1.amazonaws.com"
String dockerTag = project.hasProperty('branchName') && project.hasProperty('branchVersion') ? "${project.property('branchName')}-${project.property('branchVersion')}" : "test"

jib {
  from {
    image = "$dockerRepo/docker-java-11.0.5-jre:master-11".toString
  }
  to {
    image = "$dockerRepo/$projectName:$dockerTag".toString()
  }
  container {
    jvmFlags = ['-Xmx1024m', '-XX:+ExitOnOutOfMemoryError', "-javaagent:/opt/jolokia.jar=port=${jolokiaPort},host=*".toString()]
    mainClass = projectMainClass
    ports = [jolokiaPort]
  }
}